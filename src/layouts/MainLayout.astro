---
// src/layouts/MainLayout.astro
import '../styles/global.css';
import NavBar from '../components/NavBar.astro';

interface Props {
	title: string;
  // This new prop tells the layout if it's a summary page
  isSummaryPage?: boolean;
}

const { title, isSummaryPage = false } = Astro.props;
---

<!doctype html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta name="description" content="AbyssiniaLibrary Book Summaries" />
		<meta name="viewport" content="width=device-width" />
		<link rel="icon" type="image/svg+xml" href="/favicon.svg" />
		<title>{title} | AbyssiniaLibrary</title>
	</head>
	<body>
    <!-- The reading progress bar, only visible on summary pages -->
    {isSummaryPage && <div id="progress-bar"></div>}

		<NavBar />
    
		<main>
			<slot /> <!-- Page content goes here -->

      <!-- The share button will only be rendered if the slot is used -->
      <slot name="after-content" />
		</main>

    <script define:vars={{ isSummaryPage }}>
      // This script only runs if we are on a summary page
      if (isSummaryPage) {
        const progressBar = document.getElementById('progress-bar');
        
        window.addEventListener('scroll', () => {
          const totalHeight = document.documentElement.scrollHeight - window.innerHeight;
          const progress = (window.scrollY / totalHeight) * 100;
          progressBar.style.width = `${progress}%`;
        });
      }
    </script>
	</body>
</html>

<style>
  main {
    max-width: 800px;
    margin: 0 auto;
    padding: 0 1rem;
  }
  /* Style for the progress bar */
  #progress-bar {
    position: fixed;
    top: 0;
    left: 0;
    height: 4px;
    background-color: var(--color-primary);
    width: 0%;
    z-index: 20; /* Ensure it's on top of everything */
    transition: width 0.1s linear;
  }
</style>