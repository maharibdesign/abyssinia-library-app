---
// src/pages/summaries/[slug].astro
import MainLayout from '../../layouts/MainLayout.astro';
import { getCollection } from 'astro:content';
import FavoriteButton from '../../components/FavoriteButton.tsx'; 

export async function getStaticPaths() {
  const summaryEntries = await getCollection('summaries');
  return summaryEntries.map(entry => ({
    params: { slug: entry.slug },
    props: { entry },
  }));
}

const { entry } = Astro.props;
const { Content } = await entry.render();
// Get the new pdfUrl from the data
const { title, author, pdfUrl } = entry.data;
const { slug } = entry;
---

<MainLayout title={title} isSummaryPage={true}>
  <div class="title-header">
    <h1>{title}</h1>
    <FavoriteButton bookSlug={slug} client:load />
  </div>
  <p class="author"><em>by {author}</em></p>
  <hr>
  
  <div class="summary-content">
    <Content />
  </div>

  <div slot="after-content" class="action-buttons-container">
    <!-- The new Download button inside a link tag -->
    <a href={pdfUrl} target="_blank" rel="noopener noreferrer" class="action-btn download-btn">Download PDF</a>
    <!-- The existing Share button -->
    <button id="share-button" class="action-btn">Share Summary</button>
  </div>
</MainLayout>

<script>
  const shareButton = document.getElementById('share-button');
  shareButton.addEventListener('click', async () => { /* ... script unchanged ... */ });
</script>

<style>
  .title-header { display: flex; justify-content: space-between; align-items: center; gap: 1rem; }
  h1 { color: var(--color-primary); margin-bottom: 0; }
  .author { margin-top: 0.25rem; }
  hr { border: 0; border-top: 1px solid var(--color-border); margin: 1rem 0; }
  .summary-content { line-height: 1.6; }
  
  /* New styles for the action button container */
  .action-buttons-container {
    margin-top: 3rem;
    display: flex;
    justify-content: center;
    gap: 1rem;
  }
  .action-btn {
    border: none;
    color: white;
    padding: 12px 24px;
    border-radius: 6px;
    font-size: 1rem;
    font-weight: 600;
    cursor: pointer;
    transition: background-color 0.2s;
    text-decoration: none; /* For the <a> tag */
    display: inline-block; /* For the <a> tag */
  }
  /* Primary button style */
  #share-button {
    background-color: var(--color-primary);
  }
  #share-button:hover {
    background-color: #1f6eef; /* A slightly darker blue */
  }
  /* Secondary button style for Download */
  .download-btn {
    background-color: var(--color-card-bg);
    border: 1px solid var(--color-border);
    color: var(--color-text);
  }
  .download-btn:hover {
    border-color: var(--color-primary);
  }
</style>