---
// src/pages/summaries/[slug].astro
import MainLayout from '../../layouts/MainLayout.astro';
import { getCollection } from 'astro:content';
import FavoriteButton from '../../components/FavoriteButton.tsx'; 

export async function getStaticPaths() { /* ... unchanged ... */ }
const { entry } = Astro.props;
const { Content } = await entry.render();
const { title, author } = entry.data;
const { slug } = entry;
---

<!-- Pass isSummaryPage={true} to enable the progress bar -->
<MainLayout title={title} isSummaryPage={true}>
  <div class="title-header">
    <h1>{title}</h1>
    <FavoriteButton bookSlug={slug} client:load />
  </div>
  <p class="author"><em>by {author}</em></p>
  <hr>
  
  <div class="summary-content">
    <Content />
  </div>

  <!-- This content goes into the "after-content" slot in the layout -->
  <div slot="after-content" class="share-section">
    <button id="share-button">Share this Summary</button>
  </div>
</MainLayout>

<script>
  const shareButton = document.getElementById('share-button');
  shareButton.addEventListener('click', async () => {
    const shareData = {
      title: document.title,
      text: `Check out this summary of "${document.title.split('|')[0].trim()}" on AbyssiniaLibrary!`,
      url: window.location.href,
    };

    try {
      // Use the modern Web Share API if available
      if (navigator.share) {
        await navigator.share(shareData);
        shareButton.textContent = 'Shared!';
      } else {
        // Fallback for desktop: copy link to clipboard
        await navigator.clipboard.writeText(window.location.href);
        shareButton.textContent = 'Link Copied!';
      }
    } catch (err) {
      console.error("Couldn't share:", err);
      shareButton.textContent = 'Error Sharing';
    }

    // Reset button text after a moment
    setTimeout(() => {
      shareButton.textContent = 'Share this Summary';
    }, 2000);
  });
</script>

<style>
  /* ... all previous styles ... */
  .title-header { display: flex; justify-content: space-between; align-items: center; gap: 1rem; }
  h1 { color: var(--color-primary); margin-bottom: 0; }
  .author { margin-top: 0.25rem; }
  hr { border: 0; border-top: 1px solid var(--color-border); margin: 1rem 0; }
  .summary-content { line-height: 1.6; }
  /* New styles for the share button */
  .share-section {
    margin-top: 3rem;
    text-align: center;
  }
  #share-button {
    background-color: var(--color-primary);
    border: none;
    color: white;
    padding: 12px 24px;
    border-radius: 6px;
    font-size: 1rem;
    font-weight: 600;
    cursor: pointer;
    transition: background-color 0.2s;
  }
  #share-button:hover {
    background-color: #1f6eef;
  }
</style>